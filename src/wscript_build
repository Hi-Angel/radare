#! /usr/bin/env python

# build subdirectories
bld.add_subdirs('plug/hack')
bld.add_subdirs('hasher')
bld.add_subdirs('radiff')
bld.add_subdirs('rabin')
bld.add_subdirs('javasm')


xrefs = bld.new_task_gen('cc', 'program')
xrefs.target = 'xrefs'
xrefs.source = 'xrefs.c'

obj = bld.new_task_gen('cc', 'program')
obj.env.append_value('CCFLAGS','-DRADARE_CORE')
obj.env.append_value('LINKFLAGS','-ldl') ## XXX: only for linux
obj.env.append_value('LINKFLAGS','-lm') ## XXX: only for unix
obj.target = 'radare'
obj.packages='gtk+-2.0'

if Options.options.DEBUGGER:
	bld.add_subdirs('dbg')
	obj.uselib_local = 'debugger'

# sources for radare-core
obj.source = 'aes-find.c analyze.c binparse.c bytepat.c cmds.c code.c config.c cons.c dietline.c environ.c flags.c grava.c hack.c io.c main.c plugin.c print.c project.c rabin.c radare.c rdb.c readline.c search.c socket.c stripstr.c trace.c undo.c visual.c utils.c hist.c radiff/rdbdiff.c hasher/hash.c vm.c hasher/entropy.c hasher/crc16.c rabin/javasm.c'
# olly assembler
obj.source += ' arch/x86/ollyasm/assembl.c'
obj.source += ' arch/x86/ollyasm/asmserv.c'
obj.source += ' arch/x86/ollyasm/disasm.c'
# rest of dirs
obj.find_sources_in_dirs('rasm')
obj.find_sources_in_dirs('arch/x86')
obj.find_sources_in_dirs('arch/x86/udis86')
obj.find_sources_in_dirs('arch/msil')
obj.find_sources_in_dirs('arch/ppc')
obj.find_sources_in_dirs('arch/sparc')
obj.find_sources_in_dirs('arch/arm')
obj.find_sources_in_dirs('arch/arm/gnu')
obj.find_sources_in_dirs('arch/m68k')
obj.find_sources_in_dirs('arch/java')
obj.find_sources_in_dirs('arch/csr')
obj.find_sources_in_dirs('arch/mips')

obj.includes = '../'

# Subdirectories
bld.add_subdirs('plug/io')
obj.uselib_local += ' plug-io'

bld.libs = 'readline'
bld.libs = 'dl'
obj.includes = '.. include'

#lsb = bld.create_obj('cc', 'program')
#lsb.target = 'lsbstego'
